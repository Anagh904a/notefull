<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notefull Setup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in { animation: slideIn 0.5s ease-out; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-slow { animation: pulse 2s ease-in-out infinite; }
        
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4">
    
    <!-- Modal Overlay -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 slide-in overflow-hidden">
            
            <!-- Modal Content -->
            <div id="modalContent" class="p-8">
                <!-- Initial Screen -->
                <div id="initialScreen">
                    <div class="text-center mb-6">
                        <div class="mx-auto w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mb-4">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                        </div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome to Notefull</h2>
                        <p class="text-gray-600">Before continuing, we need to download some components</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-100 to-indigo-100 rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center">
                                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Notefull Components</h3>
                                    <p class="text-sm text-gray-600">Essential app resources</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-purple-600">23 MB</p>
                                <p class="text-xs text-gray-500">Download size</p>
                            </div>
                        </div>
                        
                        <div class="space-y-2 text-sm text-gray-700">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                                </svg>
                                <span>UI themes and assets</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                                </svg>
                                <span>Core functionality libraries</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                                </svg>
                                <span>Configuration files</span>
                            </div>
                        </div>
                    </div>
                    
                    <button id="startBtn" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-4 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                        Start Download
                    </button>
                </div>
                
                <!-- Download Screen -->
                <div id="downloadScreen" class="hidden">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Downloading Components</h2>
                        <p class="text-gray-600">Please keep this tab open</p>
                    </div>
                    
                    <!-- Slideshow Messages -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 min-h-[120px] flex items-center justify-center">
                        <p id="slideMessage" class="text-lg text-gray-700 text-center slide-in"></p>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span id="progressText">Initializing download...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div id="progressBar" class="bg-gradient-to-r from-purple-500 via-indigo-500 to-purple-500 h-full rounded-full transition-all duration-500 ease-out bg-[length:200%_100%]" style="width: 0%; animation: gradient 2s ease-in-out infinite;"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-2">
                            <span id="downloadSpeed">0.0 MB/s</span>
                            <span id="downloadSize">0 MB / 23 MB</span>
                        </div>
                    </div>
                    
                    <div id="statusMessage" class="text-center text-sm text-gray-500 pulse-slow">Preparing download...</div>
                </div>
                
                <!-- Success Screen -->
                <div id="successScreen" class="hidden text-center">
                    <div class="mx-auto w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center mb-6 slide-in">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Setup Complete!</h2>
                    <p class="text-gray-600 mb-6">All components are ready. Let's get started!</p>
                    <button id="continueBtn" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Continue to App
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Random file URL for download (23MB file - won't be stored)
        const DOWNLOAD_URL = 'https://speed.hetzner.de/10GB.bin'; // Fast download server
        
        const slideMessages = [
            "ðŸ“¦ Downloading UI components...",
            "ðŸŽ¨ Loading themes and styles...",
            "âš™ï¸ Configuring application settings...",
            "ðŸ”§ Installing core libraries...",
            "âœ¨ Optimizing performance...",
            "ðŸš€ Almost ready to launch..."
        ];
        
        let currentSlide = 0;
        let slideInterval;
        
        // Update slideshow
        function updateSlide() {
            const messageEl = document.getElementById('slideMessage');
            messageEl.style.opacity = '0';
            
            setTimeout(() => {
                messageEl.textContent = slideMessages[currentSlide];
                messageEl.style.opacity = '1';
                currentSlide = (currentSlide + 1) % slideMessages.length;
            }, 300);
        }
        
        // Actually download a real 23MB file and track real progress
        async function downloadFile() {
            try {
                document.getElementById('progressText').textContent = 'Connecting...';
                
                // Use a 23MB file - this will take real time based on internet speed
                const fileUrl = 'https://speed.hetzner.de/100MB.bin'; // 100MB file
                
                const response = await fetch(fileUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const contentLength = response.headers.get('content-length');
                let total = contentLength ? parseInt(contentLength, 10) : 23 * 1024 * 1024;
                
                // If file is larger, we'll just pretend it's 23MB for display
                const displayTotal = 23; // MB for display
                
                const reader = response.body.getReader();
                let loaded = 0;
                const startTime = Date.now();
                
                document.getElementById('progressText').textContent = 'Downloading...';
                
                while (true) {
                    const { done, value } = await reader.read();
                    
                    if (done) break;
                    
                    loaded += value.length;
                    
                    // Stop reading after 23MB
                    if (loaded >= 23 * 1024 * 1024) {
                        reader.cancel();
                        break;
                    }
                    
                    // Calculate progress
                    const targetSize = 23 * 1024 * 1024; // 23MB in bytes
                    const percent = Math.round((loaded / targetSize) * 100);
                    const loadedMB = (loaded / (1024 * 1024)).toFixed(1);
                    const elapsed = (Date.now() - startTime) / 1000;
                    const speed = (loaded / (1024 * 1024) / elapsed).toFixed(1);
                    
                    // Update UI with real progress
                    document.getElementById('progressBar').style.width = Math.min(percent, 100) + '%';
                    document.getElementById('progressPercent').textContent = Math.min(percent, 100) + '%';
                    document.getElementById('downloadSpeed').textContent = speed + ' MB/s';
                    document.getElementById('downloadSize').textContent = `${loadedMB} MB / ${displayTotal} MB`;
                    document.getElementById('statusMessage').textContent = `Downloaded ${loadedMB} MB`;
                }
                
                // Download complete
                clearInterval(slideInterval);
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercent').textContent = '100%';
                document.getElementById('progressText').textContent = 'Download complete!';
                
                setTimeout(() => {
                    document.getElementById('downloadScreen').classList.add('hidden');
                    document.getElementById('successScreen').classList.remove('hidden');
                }, 500);
                
            } catch (error) {
                console.error('Download error:', error);
                // If real download fails, fall back to simulation
                document.getElementById('statusMessage').textContent = 'Retrying download...';
                setTimeout(() => simulateDownloadWithoutFetch(), 1000);
            }
        }
        
        // Fallback simulation without actual fetch
        function simulateDownloadWithoutFetch() {
            document.getElementById('progressText').textContent = 'Downloading...';
            
            const totalSize = 23;
            const duration = 30000;
            const startTime = Date.now();
            
            const interval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easedProgress = progress < 0.5 
                    ? 2 * progress * progress 
                    : 1 - Math.pow(-2 * progress + 2, 2) / 2;
                
                const percent = Math.round(easedProgress * 100);
                const downloaded = (easedProgress * totalSize).toFixed(1);
                const speed = ((easedProgress * totalSize) / (elapsed / 1000)).toFixed(1);
                
                document.getElementById('progressBar').style.width = percent + '%';
                document.getElementById('progressPercent').textContent = percent + '%';
                document.getElementById('downloadSpeed').textContent = speed + ' MB/s';
                document.getElementById('downloadSize').textContent = `${downloaded} MB / ${totalSize} MB`;
                document.getElementById('statusMessage').textContent = `Downloaded ${downloaded} MB`;
                
                if (progress >= 1) {
                    clearInterval(interval);
                    clearInterval(slideInterval);
                    
                    document.getElementById('progressText').textContent = 'Download complete!';
                    
                    setTimeout(() => {
                        document.getElementById('downloadScreen').classList.add('hidden');
                        document.getElementById('successScreen').classList.remove('hidden');
                    }, 500);
                }
            }, 100);
        }
        
        // Event listeners
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('initialScreen').classList.add('hidden');
            document.getElementById('downloadScreen').classList.remove('hidden');
            
            // Start slideshow
            updateSlide();
            slideInterval = setInterval(updateSlide, 4000);
            
            // Start download simulation
            downloadFile();
        });
        
        document.getElementById('continueBtn').addEventListener('click', () => {
            // Set flag that components are downloaded
            localStorage.setItem('componentsDownloaded', 'true');
            // Redirect to next page
            window.location.href = 'indexAlpha.html';
        });
        
        // Check if components already downloaded on page load
        function checkComponentsExist() {
            try {
                const downloaded = localStorage.getItem('componentsDownloaded');
                const setupComplete = localStorage.getItem('setupComplete');
                
                if (downloaded === 'true' && setupComplete === 'true') {
                    window.location.href = 'ai.html';
                } else if (downloaded === 'true') {
                    window.location.href = 'indexAlpha.html';
                }
            } catch (error) {
                console.error('Error checking components:', error);
            }
        }
        
        // Run check on page load
        checkComponentsExist();
    </script>
</body>
</html>
